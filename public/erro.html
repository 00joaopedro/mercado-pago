<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erro no Pagamento</title>
</head>
<body>
    <div id="error-container">
        <h1>‚ùå Erro no Pagamento</h1>
        
        <div id="error-message">
            <h2>Ops! Algo deu errado</h2>
            <p id="error-description">Ocorreu um erro ao processar seu pagamento.</p>
        </div>

        <div id="error-details" style="display:none;">
            <h3>Detalhes do Erro</h3>
            <p><strong>ID do Pagamento:</strong> <span id="payment-id"></span></p>
            <p><strong>C√≥digo do Erro:</strong> <span id="error-code"></span></p>
            <p><strong>Descri√ß√£o T√©cnica:</strong> <span id="technical-error"></span></p>
        </div>

        <div id="common-solutions">
            <h3>Poss√≠veis Solu√ß√µes</h3>
            <ul>
                <li><strong>Cart√£o Recusado:</strong> Verifique os dados do cart√£o, limite dispon√≠vel ou entre em contato com seu banco</li>
                <li><strong>Dados Incorretos:</strong> Confira se todos os dados foram preenchidos corretamente</li>
                <li><strong>Problema de Conex√£o:</strong> Verifique sua conex√£o com a internet e tente novamente</li>
                <li><strong>Limite Excedido:</strong> Verifique se o valor n√£o excede o limite do seu cart√£o</li>
            </ul>
        </div>

        <div id="actions">
            <button onclick="tentarNovamente()">Tentar Novamente</button>
            <button onclick="window.location.href='/'">Voltar √† Loja</button>
            <button onclick="entrarEmContato()">Entrar em Contato</button>
        </div>

        <div id="support">
            <h4>Precisa de Ajuda?</h4>
            <p>Nossa equipe est√° pronta para ajudar:</p>
            <p>üìß Email: suporte@loja.com</p>
            <p>üìû Telefone: (11) 1234-5678</p>
            <p>üí¨ Chat: Dispon√≠vel 24/7</p>
            <p><strong>Hor√°rio de Atendimento:</strong> Segunda a Sexta, 8h √†s 18h</p>
        </div>

        <div id="faq">
            <h4>D√∫vidas Frequentes</h4>
            <details>
                <summary>Por que meu cart√£o foi recusado?</summary>
                <p>Isso pode acontecer por diversos motivos: dados incorretos, limite insuficiente, cart√£o bloqueado ou vencido. Entre em contato com seu banco para mais informa√ß√µes.</p>
            </details>
            
            <details>
                <summary>Quanto tempo demora para tentar novamente?</summary>
                <p>Voc√™ pode tentar imediatamente. Se o problema persistir, aguarde alguns minutos antes de uma nova tentativa.</p>
            </details>
            
            <details>
                <summary>Meu dinheiro foi debitado?</summary>
                <p>Se o pagamento foi rejeitado, nenhum valor foi debitado. Em caso de d√∫vidas, verifique seu extrato ou entre em contato conosco.</p>
            </details>
        </div>
    </div>

    <script>
        // Extrair par√¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        const paymentId = urlParams.get('payment_id');
        const errorCode = urlParams.get('error_code');

        // Mostrar detalhes do erro se dispon√≠veis
        if (error) {
            document.getElementById('error-description').textContent = decodeURIComponent(error);
        }

        if (paymentId) {
            document.getElementById('payment-id').textContent = paymentId;
            document.getElementById('error-details').style.display = 'block';
        }

        if (errorCode) {
            document.getElementById('error-code').textContent = errorCode;
            document.getElementById('technical-error').textContent = getErrorDescription(errorCode);
        }

        function getErrorDescription(code) {
            const errorDescriptions = {
                'cc_rejected_insufficient_amount': 'Limite insuficiente no cart√£o',
                'cc_rejected_bad_filled_date': 'Data de validade incorreta',
                'cc_rejected_bad_filled_other': 'Dados do cart√£o incorretos',
                'cc_rejected_bad_filled_security_code': 'C√≥digo de seguran√ßa incorreto',
                'cc_rejected_blacklist': 'Cart√£o na lista restrita',
                'cc_rejected_call_for_authorize': 'Autoriza√ß√£o necess√°ria do banco',
                'cc_rejected_card_disabled': 'Cart√£o desabilitado',
                'cc_rejected_duplicated_payment': 'Pagamento duplicado',
                'cc_rejected_high_risk': 'Transa√ß√£o de alto risco'
            };
            
            return errorDescriptions[code] || 'Erro n√£o identificado';
        }

        function tentarNovamente() {
            // Voltar para a p√°gina anterior ou home
            if (document.referrer && document.referrer.includes(window.location.hostname)) {
                window.history.back();
            } else {
                window.location.href = '/';
            }
        }

        function entrarEmContato() {
            const subject = 'Erro no Pagamento';
            const body = `Ol√°, tive um problema com meu pagamento.%0D%0A%0D%0ADetalhes:%0D%0A- ID do Pagamento: ${paymentId || 'N/A'}%0D%0A- Erro: ${error || 'N/A'}%0D%0A- C√≥digo: ${errorCode || 'N/A'}`;
            
            window.location.href = `mailto:suporte@loja.com?subject=${subject}&body=${body}`;
        }

        // Verificar se h√° dados no localStorage para recuperar a tentativa
        const dadosCheckout = localStorage.getItem('ultimo_checkout');
        if (dadosCheckout) {
            // Mostrar op√ß√£o de recuperar dados
            const recoveryDiv = document.createElement('div');
            recoveryDiv.innerHTML = `
                <h4>Recuperar √öltima Tentativa</h4>
                <p>Detectamos que voc√™ estava fazendo uma compra. Deseja recuperar os dados?</p>
                <button onclick="recuperarDados()">Sim, Recuperar</button>
                <button onclick="limparDados()">N√£o, Come√ßar do Zero</button>
            `;
            document.getElementById('actions').appendChild(recoveryDiv);
        }

        function recuperarDados() {
            const dados = JSON.parse(localStorage.getItem('ultimo_checkout'));
            // Implementar l√≥gica para preencher formul√°rio com dados salvos
            window.location.href = '/#checkout';
        }

        function limparDados() {
            localStorage.removeItem('ultimo_checkout');
            location.reload();
        }
    </script>
</body>
</html>